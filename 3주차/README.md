# Embedding-Index-Final

* * *


# 주제 
https://www.82cook.com 의 요리사이트에서 최근 히트 요리 레시피들을 크롤링 및 전처리 후 코랩에 텍스트 파일로 저장
저장된 파일을 임베딩 및 색인하여 검색어를 통해 원하는 텍스트파일을 불러오는 코드
Huggingface Embedding을 통한 임베딩
크로마 DB를 통한 데이터 관리 및 색인       


* * *
# 문제 

아래의 코드처럼 특정 키워드 또는 000 레시피를 알려줘와 같은 값을 줬을때 해당 검색어와 관련된 결과가 전혀 나오지 않음 


      #코드 
      db = Chroma.from_documents(docs, embedding=embeddings,
                                       persist_directory="recipe_index_hf")
      db.persist()
      query = "토스트" or query = "토스트 레시피를 알려줘"
      docs = db.similarity_search(query)
      docs[:4]
      
      #실행결과
      [Document(page_content='메뉴: 사과잼\n\n레시피:맛이없는사과나오래방치해시든사과가있으면사과잼을만들어보세요샌드위치가게의핫샌드위치에잼을바르는게유행인데맛이강하지않은사과잼이재료의맛을방해하지않아잘어울려요딸기잼처럼쨍한맛은아니지만은근하게고급스러운맛입니다재료중간크기사과개통계피계피가루조금설탕레몬개물컵만드는법사과를깎아준비합니다벗긴사과껍질에물컵과통계피를넣고불에올려요중약불에서분간끓여물을컵분량으로만들어요사과과육은강판에갈거나블렌더에갈아요가늘게채썰거나잘게깍뚝썰기해도됩니다사과즙과사과를냄비에넣고분정도끓여수분을어느정도날려주세요설탕을넣고잘섞어서끓이다레몬즙을짜서넣어요중간중간타지않도록저어주며시간정도약불에서졸여요잼의방울이터지면서화상을입을수있으니주의합니다수저로들었을때흐르지않고천천히떨어질정도로조려요소독해서말려둔유리병에담아요사과품종에따라당도나물양을조절해야합니다사과를익힐때사과껍질을졸인물대신화이트와인컵을넣으면사과와잘어울리고고급스러운맛이납니다다른요리에활용할수있는콩포트스타일로만들고싶다면정도로잘게썰어서만들거나갈아둔사과에정도섞어요', metadata={'source': '/content/drive/My Drive/Colab Notebook/recipe/레시피_20.txt'})
      [Document(page_content='메뉴: 사과잼\n\n레시피:맛이없는사과나오래방치해시든사과가있으면사과잼을만들어보세요샌드위치가게의핫샌드위치에잼을바르는게유행인데맛이강하지않은사과잼이재료의맛을방해하지않아잘어울려요딸기잼처럼쨍한맛은아니지만은근하게고급스러운맛입니다재료중간크기사과개통계피계피가루조금설탕레몬개물컵만드는법사과를깎아준비합니다벗긴사과껍질에물컵과통계피를넣고불에올려요중약불에서분간끓여물을컵분량으로만들어요사과과육은강판에갈거나블렌더에갈아요가늘게채썰거나잘게깍뚝썰기해도됩니다사과즙과사과를냄비에넣고분정도끓여수분을어느정도날려주세요설탕을넣고잘섞어서끓이다레몬즙을짜서넣어요중간중간타지않도록저어주며시간정도약불에서졸여요잼의방울이터지면서화상을입을수있으니주의합니다수저로들었을때흐르지않고천천히떨어질정도로조려요소독해서말려둔유리병에담아요사과품종에따라당도나물양을조절해야합니다사과를익힐때사과껍질을졸인물대신화이트와인컵을넣으면사과와잘어울리고고급스러운맛이납니다다른요리에활용할수있는콩포트스타일로만들고싶다면정도로잘게썰어서만들거나갈아둔사과에정도섞어요', metadata={'source': '/content/drive/My Drive/Colab Notebook/recipe/레시피_20.txt'}),
      [Document(page_content='메뉴: 사과잼\n\n레시피:맛이없는사과나오래방치해시든사과가있으면사과잼을만들어보세요샌드위치가게의핫샌드위치에잼을바르는게유행인데맛이강하지않은사과잼이재료의맛을방해하지않아잘어울려요딸기잼처럼쨍한맛은아니지만은근하게고급스러운맛입니다재료중간크기사과개통계피계피가루조금설탕레몬개물컵만드는법사과를깎아준비합니다벗긴사과껍질에물컵과통계피를넣고불에올려요중약불에서분간끓여물을컵분량으로만들어요사과과육은강판에갈거나블렌더에갈아요가늘게채썰거나잘게깍뚝썰기해도됩니다사과즙과사과를냄비에넣고분정도끓여수분을어느정도날려주세요설탕을넣고잘섞어서끓이다레몬즙을짜서넣어요중간중간타지않도록저어주며시간정도약불에서졸여요잼의방울이터지면서화상을입을수있으니주의합니다수저로들었을때흐르지않고천천히떨어질정도로조려요소독해서말려둔유리병에담아요사과품종에따라당도나물양을조절해야합니다사과를익힐때사과껍질을졸인물대신화이트와인컵을넣으면사과와잘어울리고고급스러운맛이납니다다른요리에활용할수있는콩포트스타일로만들고싶다면정도로잘게썰어서만들거나갈아둔사과에정도섞어요', metadata={'source': '/content/drive/My Drive/Colab Notebook/recipe/레시피_20.txt'}),
      [Document(page_content='메뉴: 사과잼\n\n레시피:맛이없는사과나오래방치해시든사과가있으면사과잼을만들어보세요샌드위치가게의핫샌드위치에잼을바르는게유행인데맛이강하지않은사과잼이재료의맛을방해하지않아잘어울려요딸기잼처럼쨍한맛은아니지만은근하게고급스러운맛입니다재료중간크기사과개통계피계피가루조금설탕레몬개물컵만드는법사과를깎아준비합니다벗긴사과껍질에물컵과통계피를넣고불에올려요중약불에서분간끓여물을컵분량으로만들어요사과과육은강판에갈거나블렌더에갈아요가늘게채썰거나잘게깍뚝썰기해도됩니다사과즙과사과를냄비에넣고분정도끓여수분을어느정도날려주세요설탕을넣고잘섞어서끓이다레몬즙을짜서넣어요중간중간타지않도록저어주며시간정도약불에서졸여요잼의방울이터지면서화상을입을수있으니주의합니다수저로들었을때흐르지않고천천히떨어질정도로조려요소독해서말려둔유리병에담아요사과품종에따라당도나물양을조절해야합니다사과를익힐때사과껍질을졸인물대신화이트와인컵을넣으면사과와잘어울리고고급스러운맛이납니다다른요리에활용할수있는콩포트스타일로만들고싶다면정도로잘게썰어서만들거나갈아둔사과에정도섞어요', metadata={'source': '/content/drive/My Drive/Colab Notebook/recipe/레시피_20.txt'}),
      추가 내용) 전처리를 하지 않았을때 레시피_4.txt파일이 불러와지긴 했지만 다른 내용이 불러와지기도 하는 경우 발생
      


해결방법:
요리 사이트의 레시피를 크롤링해서 가져올때 특수문자와 영어의 빈도가 낮아 전처리의 필요성을 느끼지 못하고 전처리를 하지 않아 생긴 문제
특수문자, 영어를 걸러주는 전처리 코드를 추가하자 키워드와 특정 요리의 "00 레시피를 알려줘" 검색 시 높은 정확도의 결과물을 출력함

      #코드
      db = Chroma.from_documents(docs, embedding=embeddings,
                                       persist_directory="recipe_index_hf")
      db.persist()
      query = "셀러리 주스 레시피 알려줘"
      docs = db.similarity_search(query)
      docs[:4]
      #실행결과
            [Document(page_content='메뉴: 셀러리주스\n\n레시피:득특한향의서양채소인셀러리는본래약초로쓰이다가그후식품으로먹게되었다고합니다샐러드재료또는폭찹소스토마토스프등의부재료로사용되는셀러리는우리식탁에자주오르는먹을거리는아닙니다그래서꼭필요해서한단사게되면어떻게먹어야남김없이먹을수있나걱정스러운재료이기도합니다이럴때는셀러리주스를만들어보세요셀러리에는비타민가많이들어있을뿐아니라체내나트륨배출을돕는칼륨이풍부하게들어있어건강에도움이되는식품입니다재료잔기준셀러리대물바나나개사과개레몬개만드는법셀러리는깨끗하게씻어서잎은떼어내고줄기만갈기좋은크기로자릅니다사과는껍질을벗긴후역시갈리좋은크기로잘라둡니다믹서용기에물을붓고잘라둔셀러리와사과를넣어요그위에바나나도뚝뚝잘라넣습니다레몬은껍질은벗기고씨를발라낸후과육만넣어요재료들이곱게갈릴때까지믹서를돌린후컵에담아요물과재료가분리되므로먹을때저어서마셔요성능이좋은고속믹서라면셀러리를그냥갈아도좋지만그렇지않다면셀러리거죽의질긴섬유질을조금벗겨주는게마시기편해요셀러리의진한향을느끼고싶다면바나나의양을절반으로줄여도좋아요', metadata={'source': '/content/drive/My Drive/Colab Notebook/recipe/레시피_8.txt'}),
       Document(page_content='메뉴: 셀러리주스\n\n레시피:득특한향의서양채소인셀러리는본래약초로쓰이다가그후식품으로먹게되었다고합니다샐러드재료또는폭찹소스토마토스프등의부재료로사용되는셀러리는우리식탁에자주오르는먹을거리는아닙니다그래서꼭필요해서한단사게되면어떻게먹어야남김없이먹을수있나걱정스러운재료이기도합니다이럴때는셀러리주스를만들어보세요셀러리에는비타민가많이들어있을뿐아니라체내나트륨배출을돕는칼륨이풍부하게들어있어건강에도움이되는식품입니다재료잔기준셀러리대물바나나개사과개레몬개만드는법셀러리는깨끗하게씻어서잎은떼어내고줄기만갈기좋은크기로자릅니다사과는껍질을벗긴후역시갈리좋은크기로잘라둡니다믹서용기에물을붓고잘라둔셀러리와사과를넣어요그위에바나나도뚝뚝잘라넣습니다레몬은껍질은벗기고씨를발라낸후과육만넣어요재료들이곱게갈릴때까지믹서를돌린후컵에담아요물과재료가분리되므로먹을때저어서마셔요성능이좋은고속믹서라면셀러리를그냥갈아도좋지만그렇지않다면셀러리거죽의질긴섬유질을조금벗겨주는게마시기편해요셀러리의진한향을느끼고싶다면바나나의양을절반으로줄여도좋아요', metadata={'source': '/content/drive/My Drive/Colab Notebook/recipe/레시피_8.txt'}),
       Document(page_content='메뉴: 셀러리주스\n\n레시피:득특한향의서양채소인셀러리는본래약초로쓰이다가그후식품으로먹게되었다고합니다샐러드재료또는폭찹소스토마토스프등의부재료로사용되는셀러리는우리식탁에자주오르는먹을거리는아닙니다그래서꼭필요해서한단사게되면어떻게먹어야남김없이먹을수있나걱정스러운재료이기도합니다이럴때는셀러리주스를만들어보세요셀러리에는비타민가많이들어있을뿐아니라체내나트륨배출을돕는칼륨이풍부하게들어있어건강에도움이되는식품입니다재료잔기준셀러리대물바나나개사과개레몬개만드는법셀러리는깨끗하게씻어서잎은떼어내고줄기만갈기좋은크기로자릅니다사과는껍질을벗긴후역시갈리좋은크기로잘라둡니다믹서용기에물을붓고잘라둔셀러리와사과를넣어요그위에바나나도뚝뚝잘라넣습니다레몬은껍질은벗기고씨를발라낸후과육만넣어요재료들이곱게갈릴때까지믹서를돌린후컵에담아요물과재료가분리되므로먹을때저어서마셔요성능이좋은고속믹서라면셀러리를그냥갈아도좋지만그렇지않다면셀러리거죽의질긴섬유질을조금벗겨주는게마시기편해요셀러리의진한향을느끼고싶다면바나나의양을절반으로줄여도좋아요', metadata={'source': '/content/drive/My Drive/Colab Notebook/recipe/레시피_8.txt'}),
       Document(page_content='메뉴: 셀러리주스\n\n레시피:득특한향의서양채소인셀러리는본래약초로쓰이다가그후식품으로먹게되었다고합니다샐러드재료또는폭찹소스토마토스프등의부재료로사용되는셀러리는우리식탁에자주오르는먹을거리는아닙니다그래서꼭필요해서한단사게되면어떻게먹어야남김없이먹을수있나걱정스러운재료이기도합니다이럴때는셀러리주스를만들어보세요셀러리에는비타민가많이들어있을뿐아니라체내나트륨배출을돕는칼륨이풍부하게들어있어건강에도움이되는식품입니다재료잔기준셀러리대물바나나개사과개레몬개만드는법셀러리는깨끗하게씻어서잎은떼어내고줄기만갈기좋은크기로자릅니다사과는껍질을벗긴후역시갈리좋은크기로잘라둡니다믹서용기에물을붓고잘라둔셀러리와사과를넣어요그위에바나나도뚝뚝잘라넣습니다레몬은껍질은벗기고씨를발라낸후과육만넣어요재료들이곱게갈릴때까지믹서를돌린후컵에담아요물과재료가분리되므로먹을때저어서마셔요성능이좋은고속믹서라면셀러리를그냥갈아도좋지만그렇지않다면셀러리거죽의질긴섬유질을조금벗겨주는게마시기편해요셀러리의진한향을느끼고싶다면바나나의양을절반으로줄여도좋아요', metadata={'source': '/content/drive/My Drive/Colab Notebook/recipe/레시피_8.txt'})]

       #코드
      db = Chroma.from_documents(docs, embedding=embeddings,
                                 persist_directory="recipe_index_hf")
      db.persist()
      query = "참치죽"
      docs = db.similarity_search(query)
      docs[:4]

      #실행결과
      [Document(page_content='메뉴: 참치죽\n\n레시피:죽집의베스트셀러중하나인참치죽어느가정이나상비하는재료인참치로죽을만들어보세요전복이나쇠고기등은상비하는재료가아니고손질이나양념을해야하는데비해참치는바로죽을만들수있습니다밥을이용하면분정도면쉽게만들수있어요재료인분밥컵채소감자호박당근양파버섯등다진것컵참치캔작은것물컵참기름큰술소금작은술국간장큰술후추약간만드는법참치는기름을빼두고채소는잘게다져요냄비에참기름을두르고채소와참치를넣고잠시볶아주세요밥과물을넣고끓여요중간불에서중간중간타지않게저어주면서밥알이표면에완전히떠오를때까지끓여요소금후추로간합니다간을본수저를죽냄비에넣으면전분이풀어져끈기가사라지니간을다시볼때는꼭새수저를사용해야합니다간을딱맞추지않고간장참기름깨소금을종지에담아서조금씩비벼먹어도별미입니다', metadata={'source': '/content/drive/My Drive/Colab Notebook/recipe/레시피_15.txt'}),
       Document(page_content='메뉴: 참치죽\n\n레시피:죽집의베스트셀러중하나인참치죽어느가정이나상비하는재료인참치로죽을만들어보세요전복이나쇠고기등은상비하는재료가아니고손질이나양념을해야하는데비해참치는바로죽을만들수있습니다밥을이용하면분정도면쉽게만들수있어요재료인분밥컵채소감자호박당근양파버섯등다진것컵참치캔작은것물컵참기름큰술소금작은술국간장큰술후추약간만드는법참치는기름을빼두고채소는잘게다져요냄비에참기름을두르고채소와참치를넣고잠시볶아주세요밥과물을넣고끓여요중간불에서중간중간타지않게저어주면서밥알이표면에완전히떠오를때까지끓여요소금후추로간합니다간을본수저를죽냄비에넣으면전분이풀어져끈기가사라지니간을다시볼때는꼭새수저를사용해야합니다간을딱맞추지않고간장참기름깨소금을종지에담아서조금씩비벼먹어도별미입니다', metadata={'source': '/content/drive/My Drive/Colab Notebook/recipe/레시피_15.txt'}),
       Document(page_content='메뉴: 참치죽\n\n레시피:죽집의베스트셀러중하나인참치죽어느가정이나상비하는재료인참치로죽을만들어보세요전복이나쇠고기등은상비하는재료가아니고손질이나양념을해야하는데비해참치는바로죽을만들수있습니다밥을이용하면분정도면쉽게만들수있어요재료인분밥컵채소감자호박당근양파버섯등다진것컵참치캔작은것물컵참기름큰술소금작은술국간장큰술후추약간만드는법참치는기름을빼두고채소는잘게다져요냄비에참기름을두르고채소와참치를넣고잠시볶아주세요밥과물을넣고끓여요중간불에서중간중간타지않게저어주면서밥알이표면에완전히떠오를때까지끓여요소금후추로간합니다간을본수저를죽냄비에넣으면전분이풀어져끈기가사라지니간을다시볼때는꼭새수저를사용해야합니다간을딱맞추지않고간장참기름깨소금을종지에담아서조금씩비벼먹어도별미입니다', metadata={'source': '/content/drive/My Drive/Colab Notebook/recipe/레시피_15.txt'}),
       Document(page_content='메뉴: 참치죽\n\n레시피:죽집의베스트셀러중하나인참치죽어느가정이나상비하는재료인참치로죽을만들어보세요전복이나쇠고기등은상비하는재료가아니고손질이나양념을해야하는데비해참치는바로죽을만들수있습니다밥을이용하면분정도면쉽게만들수있어요재료인분밥컵채소감자호박당근양파버섯등다진것컵참치캔작은것물컵참기름큰술소금작은술국간장큰술후추약간만드는법참치는기름을빼두고채소는잘게다져요냄비에참기름을두르고채소와참치를넣고잠시볶아주세요밥과물을넣고끓여요중간불에서중간중간타지않게저어주면서밥알이표면에완전히떠오를때까지끓여요소금후추로간합니다간을본수저를죽냄비에넣으면전분이풀어져끈기가사라지니간을다시볼때는꼭새수저를사용해야합니다간을딱맞추지않고간장참기름깨소금을종지에담아서조금씩비벼먹어도별미입니다', metadata={'source': '/content/drive/My Drive/Colab Notebook/recipe/레시피_15.txt'})]

나아지긴 했지만 특정 레시피와 키워드로 값을 주면 값이 정확하지 않는 문제가 발생
특정 레시피에 다른 레시피의 음식과 재료가 섞여있어서 찾는게 정확하지 않아 정확하고 성능좋은 임베딩 라이브러리를 통해 해결가능할 것 같다.
* * *

# 알게된 점
데이터를 가져와 전처리 하며 더 나아가 인공지능을 다룰 때 자연어처리를 하는 이유와 중요성과 정확도와 결과물에 큰 영향을 끼친다는 걸 다시한번 깨닫게 됨

HuggingFaceEmbeddings말고도 여러 임베딩 라이브러리가 있지만 기회가 되면 성능이 좋지만 유로인 openAI 임베딩 라이브러리들을 사용해볼 것 이다.

* * *
# 코드 설명
코드내에 주석처리
