# Embedding-Index-Final

* * *


# 주제 
https://www.82cook.com 의 요리사이트에서 최근 히트 요리 레시피들을 크롤링 및 전처리 후 코랩에 텍스트 파일로 저장
저장된 파일을 임베딩 및 색인하여 검색어를 통해 원하는 텍스트파일을 불러오는 코드


* * *

문제: 제대로 된 결과X 
임베딩 문제?, 색인 문제? 
자료의 갯수 문제? 크롤링을 추가
BUT 웹페이지가 바뀌기 때문에 새로운 코드 추가 
전처리 문제? 영어 한글외 불필요한 특수문자는 거의 없기에 전처리 문제는 아닐가능성이큼 
코드 수정 과정: 네이버 카페 크롤링 과정


* * *
#문제1

아래의 코드처럼 특정 키워드 또는 000 레시피를 알려줘와 같은 값을 줬을때 해당 검색어와 관련된 결과가 전혀 나오지 않음 


      #코드 
      db = Chroma.from_documents(docs, embedding=embeddings,
                                       persist_directory="recipe_index_hf")
      db.persist()
      query = "토스트" or query = "토스트 레시피를 알려줘"
      docs = db.similarity_search(query)
      docs[:4]
      
      #실행결과
      [Document(page_content='메뉴: 사과잼\n\n레시피:맛이없는사과나오래방치해시든사과가있으면사과잼을만들어보세요샌드위치가게의핫샌드위치에잼을바르는게유행인데맛이강하지않은사과잼이재료의맛을방해하지않아잘어울려요딸기잼처럼쨍한맛은아니지만은근하게고급스러운맛입니다재료중간크기사과개통계피계피가루조금설탕레몬개물컵만드는법사과를깎아준비합니다벗긴사과껍질에물컵과통계피를넣고불에올려요중약불에서분간끓여물을컵분량으로만들어요사과과육은강판에갈거나블렌더에갈아요가늘게채썰거나잘게깍뚝썰기해도됩니다사과즙과사과를냄비에넣고분정도끓여수분을어느정도날려주세요설탕을넣고잘섞어서끓이다레몬즙을짜서넣어요중간중간타지않도록저어주며시간정도약불에서졸여요잼의방울이터지면서화상을입을수있으니주의합니다수저로들었을때흐르지않고천천히떨어질정도로조려요소독해서말려둔유리병에담아요사과품종에따라당도나물양을조절해야합니다사과를익힐때사과껍질을졸인물대신화이트와인컵을넣으면사과와잘어울리고고급스러운맛이납니다다른요리에활용할수있는콩포트스타일로만들고싶다면정도로잘게썰어서만들거나갈아둔사과에정도섞어요', metadata={'source': '/content/drive/My Drive/Colab Notebook/recipe/레시피_20.txt'})
      [Document(page_content='메뉴: 사과잼\n\n레시피:맛이없는사과나오래방치해시든사과가있으면사과잼을만들어보세요샌드위치가게의핫샌드위치에잼을바르는게유행인데맛이강하지않은사과잼이재료의맛을방해하지않아잘어울려요딸기잼처럼쨍한맛은아니지만은근하게고급스러운맛입니다재료중간크기사과개통계피계피가루조금설탕레몬개물컵만드는법사과를깎아준비합니다벗긴사과껍질에물컵과통계피를넣고불에올려요중약불에서분간끓여물을컵분량으로만들어요사과과육은강판에갈거나블렌더에갈아요가늘게채썰거나잘게깍뚝썰기해도됩니다사과즙과사과를냄비에넣고분정도끓여수분을어느정도날려주세요설탕을넣고잘섞어서끓이다레몬즙을짜서넣어요중간중간타지않도록저어주며시간정도약불에서졸여요잼의방울이터지면서화상을입을수있으니주의합니다수저로들었을때흐르지않고천천히떨어질정도로조려요소독해서말려둔유리병에담아요사과품종에따라당도나물양을조절해야합니다사과를익힐때사과껍질을졸인물대신화이트와인컵을넣으면사과와잘어울리고고급스러운맛이납니다다른요리에활용할수있는콩포트스타일로만들고싶다면정도로잘게썰어서만들거나갈아둔사과에정도섞어요', metadata={'source': '/content/drive/My Drive/Colab Notebook/recipe/레시피_20.txt'}),
      [Document(page_content='메뉴: 사과잼\n\n레시피:맛이없는사과나오래방치해시든사과가있으면사과잼을만들어보세요샌드위치가게의핫샌드위치에잼을바르는게유행인데맛이강하지않은사과잼이재료의맛을방해하지않아잘어울려요딸기잼처럼쨍한맛은아니지만은근하게고급스러운맛입니다재료중간크기사과개통계피계피가루조금설탕레몬개물컵만드는법사과를깎아준비합니다벗긴사과껍질에물컵과통계피를넣고불에올려요중약불에서분간끓여물을컵분량으로만들어요사과과육은강판에갈거나블렌더에갈아요가늘게채썰거나잘게깍뚝썰기해도됩니다사과즙과사과를냄비에넣고분정도끓여수분을어느정도날려주세요설탕을넣고잘섞어서끓이다레몬즙을짜서넣어요중간중간타지않도록저어주며시간정도약불에서졸여요잼의방울이터지면서화상을입을수있으니주의합니다수저로들었을때흐르지않고천천히떨어질정도로조려요소독해서말려둔유리병에담아요사과품종에따라당도나물양을조절해야합니다사과를익힐때사과껍질을졸인물대신화이트와인컵을넣으면사과와잘어울리고고급스러운맛이납니다다른요리에활용할수있는콩포트스타일로만들고싶다면정도로잘게썰어서만들거나갈아둔사과에정도섞어요', metadata={'source': '/content/drive/My Drive/Colab Notebook/recipe/레시피_20.txt'}),
      [Document(page_content='메뉴: 사과잼\n\n레시피:맛이없는사과나오래방치해시든사과가있으면사과잼을만들어보세요샌드위치가게의핫샌드위치에잼을바르는게유행인데맛이강하지않은사과잼이재료의맛을방해하지않아잘어울려요딸기잼처럼쨍한맛은아니지만은근하게고급스러운맛입니다재료중간크기사과개통계피계피가루조금설탕레몬개물컵만드는법사과를깎아준비합니다벗긴사과껍질에물컵과통계피를넣고불에올려요중약불에서분간끓여물을컵분량으로만들어요사과과육은강판에갈거나블렌더에갈아요가늘게채썰거나잘게깍뚝썰기해도됩니다사과즙과사과를냄비에넣고분정도끓여수분을어느정도날려주세요설탕을넣고잘섞어서끓이다레몬즙을짜서넣어요중간중간타지않도록저어주며시간정도약불에서졸여요잼의방울이터지면서화상을입을수있으니주의합니다수저로들었을때흐르지않고천천히떨어질정도로조려요소독해서말려둔유리병에담아요사과품종에따라당도나물양을조절해야합니다사과를익힐때사과껍질을졸인물대신화이트와인컵을넣으면사과와잘어울리고고급스러운맛이납니다다른요리에활용할수있는콩포트스타일로만들고싶다면정도로잘게썰어서만들거나갈아둔사과에정도섞어요', metadata={'source': '/content/drive/My Drive/Colab Notebook/recipe/레시피_20.txt'}),
      추가 내용) 전처리를 하지 않았을때 레시피_4.txt파일이 불러와지긴 했지만 다른 내용이 불러와지기도 하는 경우 발생
      


해결방법:
요리 사이트의 레시피를 크롤링해서 가져올때 특수문자와 영어의 빈도가 낮아 전처리의 필요성을 느끼지 못하고 전처리를 하지 않아 생긴 문제
특수문자, 영어를 걸러주는 전처리 코드를 추가하자 키워드와 특정 요리의 "00 레시피를 알려줘" 검색 시 높은 정확도의 결과물을 출력함

      #코드
      db = Chroma.from_documents(docs, embedding=embeddings,
                                       persist_directory="recipe_index_hf")
      db.persist()
      query = "셀러리 주스 레시피 알려줘"
      docs = db.similarity_search(query)
      docs[:4]
      #결과값
      Document(page_content='메뉴: 셀러리주스\n\n레시피:득특한향의서양채소인셀러리는본래약초로쓰이다가그후식품으로먹게되었다고합니다샐러드재료또는폭찹소스토마토스프등의부재료로사용되는셀러리는우리식탁에자주오르는먹을거리는아닙니다그래서꼭필요해서한단사과
#문제2 

전처리를 통해 키워드로 값을 줬을때는 해당 검색어와 관련된 결과값이 나오긴 하지만 00 레시피를 알려줘, 00 요리를 알려줘와 같이 문장으로 작성하면 




미역, 샌드위치, 사과 레시피를  치면 해당 레시피가 나오긴하지만 특정 레시피는  각각의 음식이 다 섞여있어서 색인해서 찾는게 정확하지 않음 
00 레시피를 적으면 특정 레시피만 계속 뜸

문제는 전처리였따!!!!!!!!!!!!!!!!!!!!!!!!!!!! 전처리를 꼭 해줘야 정확도가 올라감
코랩은 변덕이 심함
<img<img width="1247" alt="image" src="https://github.com/An-Jeong-Jin/AI-Task/assets/120768669/0f67c929-17c7-4613-b988-3e7fca6dd87e">
>
<img width="1231" alt="image" src="https://github.com/An-Jeong-Jin/AI-Task/assets/120768669/533a6a89-6871-46a1-894c-cd6d8eb788c0">
<img width="1237" alt="image" src="https://github.com/An-Jeong-Jin/AI-Task/assets/120768669/7ad5da6f-6cf7-467f-b2c5-b38d1ce546b5">
<img width="1244" alt="image" src="https://github.com/An-Jeong-Jin/AI-Task/assets/120768669/530a8c75-37fb-4873-8fd3-f139fc6b227c">

* * *
#코드 설명
코드내에 주석처리
